{% import "macros.html" as macros %}

<!--Java Macros-->
<!--Macro for a Java CRUD app on Linux and Mac-->
{% macro javaCRUD()%}
<h4>Create a Java app that connects to SQL Server and executes queries</h4>
<p>Change to your home directory. Create your Maven starter package. This will create the project directory with a basic Maven project and pom.xml file.</p>
<pre class="command-line" data-prompt="$"><code class="language-terminal">cd ~/
mvn archetype:generate -DgroupId=com.sqlsamples -DartifactId=SqlServerSample -DarchetypeArtifactId=maven-archetype-quickstart -Dversion=1.0.0</code></pre>
<pre><code class="language-results">[INFO] Scanning for projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building Maven Stub Project (No POM) 1
[INFO] ------------------------------------------------------------------------
...
[INFO] Generating project in Interactive mode
[INFO] Using property: groupId = com.sqlsamples
[INFO] Using property: artifactId = SqlServerSample
[INFO] Using property: version = 1.0.0
[INFO] Using property: package = com.sqlsamples
Confirm properties configuration:
groupId: com.sqlsamples
artifactId: SqlServerSample
version: 1.0.0
package: com.sqlsamples
...
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 3.504 s
[INFO] Finished at: 2016-10-15T16:35:12-07:00
[INFO] Final Memory: 13M/176M
[INFO] ------------------------------------------------------------------------</code></pre>
<p>Change directories into your newly created project.</p>
<pre class="command-line" data-prompt="$"><code class="language-terminal">cd ~/SqlServerSample </code></pre>
<p>Add the Microsoft JDBC Driver for SQL Server dependency to your Maven project by opening your favorite text editor and copying and pasting the following lines into your <b>pom.xml</b> file. Do not overwrite the existing values prepopulated in the file. The JDBC dependency must be pasted within the larger "dependencies" section (&ltdependency> &lt/dependency>).</p>
<p>Specify the version of Java to compile the project against by adding the "properties" section below into the pom.xml file. Add the &ltproperties> section below after the &ltdependencies> section. </p>
<p>Save and close the file. </p>
<pre><code class="language-xml">
&lt!-- prepopulated content by Maven -->
&ltdependencies>
    &ltdependency>
        &ltgroupId>com.microsoft.sqlserver&lt/groupId>
        &ltartifactId>mssql-jdbc&lt/artifactId>
        &ltversion>6.1.0.jre8&lt/version>
    &lt/dependency>
    &lt!-- your existing dependencies -->
&lt/dependencies>
&ltproperties>
    &ltmaven.compiler.source>1.8&lt/maven.compiler.source>
    &ltmaven.compiler.target>1.8&lt/maven.compiler.target>
    &lt!-- your existing properties -->
&lt/properties>  
&lt!-- prepopulated content by Maven --></code></pre>
<p>You should already have a file called <b>App.java</b> in your Maven project located at: <i>~/SqlServerSample/src/main/java/com/sqlsamples/App.java</i></p>
<p>Open this file in your favorite text editor and replace the contents with the code below. Don't forget to replace the username and password with your own. Save and close the file. </p>
<pre><code class="language-java">package com.sqlsamples; 
			    
import java.sql.Connection;
import java.sql.DriverManager;

public class App {

	public static void main(String[] args) {

		String connectionUrl = "jdbc:sqlserver://localhost:1433;databaseName=master;user=sa;password=your_password";

		try {
			// Load SQL Server JDBC driver and establish connection.
			System.out.print("Connecting to SQL Server ... ");
			try (Connection connection = DriverManager.getConnection(connectionUrl)) {
				System.out.println("Done.");
			}
		} catch (Exception e) {
			System.out.println();
			e.printStackTrace();
		}
	}
}</code></pre>
<p>Build the project and create a jar package using the following command:</p>
<pre class="command-line" data-prompt="$"><code class="language-terminal">cd ~/SqlServerSample
mvn package</code></pre>
<pre><code class="language-results">[INFO] Scanning for projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building SqlServerSample 1.0.0
[INFO] ------------------------------------------------------------------------ 
...
[INFO] Building jar: /Users/usr1/SqlServerSample/target/SqlServerSample-1.0.0.jar
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 4.367 s
[INFO] Finished at: 2016-10-15T12:18:32-07:00
[INFO] Final Memory: 22M/208M
[INFO] ------------------------------------------------------------------------</code></pre>
<p>Now run the application. You can remove the of "-q" in the command below to show info messages from Maven. </p>
<pre class="command-line" data-prompt="$"><code class="language-terminal">mvn -q exec:java -Dexec.mainClass=com.sqlsamples.App</code></pre>
<pre><code class="language-results">Connecting to SQL Server ... 
Done. </code></pre>
<p>Now replace the code in <b>App.java</b> by opening the file in your favorite text editor and copying and pasting the code below into the file. This will create a database and a <a href="https://msdn.microsoft.com/en-us/library/ms189084.aspx">table</a>, and will <a href="https://msdn.microsoft.com/en-us/library/ms174335.aspx">insert</a>, <a href="https://msdn.microsoft.com/en-us/library/ms177523.aspx">update</a>, <a href="https://msdn.microsoft.com/en-us/library/ms189835.aspx">delete</a>, and <a href="https://msdn.microsoft.com/en-us/library/ms189499.aspx">read</a> a few rows. Don't forget to update the username and password with your own. Save and close the file. </p>
<pre><code class="language-java">package com.sqlsamples; 
			    
import java.sql.Connection;
import java.sql.Statement;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.DriverManager;

public class App {

	public static void main(String[] args) {

		System.out.println("Connect to SQL Server and demo Create, Read, Update and Delete operations.");

        //Update the username and password below
		String connectionUrl = "jdbc:sqlserver://localhost:1433;databaseName=master;user=sa;password=your_password";

		try {
			// Load SQL Server JDBC driver and establish connection.
			System.out.print("Connecting to SQL Server ... ");
			try (Connection connection = DriverManager.getConnection(connectionUrl)) {
				System.out.println("Done.");

				// Create a sample database
				System.out.print("Dropping and creating database 'SampleDB' ... ");
				String sql = "DROP DATABASE IF EXISTS [SampleDB]; CREATE DATABASE [SampleDB]";
				try (Statement statement = connection.createStatement()) {
					statement.executeUpdate(sql);
					System.out.println("Done.");
				}

				// Create a Table and insert some sample data
				System.out.print("Creating sample table with data, press ENTER to continue...");
				System.in.read();
				sql = new StringBuilder().append("USE SampleDB; ").append("CREATE TABLE Employees ( ")
						.append(" Id INT IDENTITY(1,1) NOT NULL PRIMARY KEY, ").append(" Name NVARCHAR(50), ")
						.append(" Location NVARCHAR(50) ").append("); ")
						.append("INSERT INTO Employees (Name, Location) VALUES ").append("(N'Jared', N'Australia'), ")
						.append("(N'Nikita', N'India'), ").append("(N'Tom', N'Germany'); ").toString();
				try (Statement statement = connection.createStatement()) {
					statement.executeUpdate(sql);
					System.out.println("Done.");
				}

				// INSERT demo
				System.out.print("Inserting a new row into table, press ENTER to continue...");
				System.in.read();
				sql = new StringBuilder().append("INSERT Employees (Name, Location) ").append("VALUES (?, ?);")
						.toString();
				try (PreparedStatement statement = connection.prepareStatement(sql)) {
					statement.setString(1, "Jake");
					statement.setString(2, "United States");
					int rowsAffected = statement.executeUpdate();
					System.out.println(rowsAffected + " row(s) inserted");
				}

				// UPDATE demo
				String userToUpdate = "Nikita";
				System.out.print("Updating 'Location' for user '" + userToUpdate + "', press ENTER to continue...");
				System.in.read();
				sql = "UPDATE Employees SET Location = N'United States' WHERE Name = ?";
				try (PreparedStatement statement = connection.prepareStatement(sql)) {
					statement.setString(1, userToUpdate);
					int rowsAffected = statement.executeUpdate();
					System.out.println(rowsAffected + " row(s) updated");
				}

				// DELETE demo
				String userToDelete = "Jared";
				System.out.print("Deleting user '" + userToDelete + "', press ENTER to continue...");
				System.in.read();
				sql = "DELETE FROM Employees WHERE Name = ?;";
				try (PreparedStatement statement = connection.prepareStatement(sql)) {
					statement.setString(1, userToDelete);
					int rowsAffected = statement.executeUpdate();
					System.out.println(rowsAffected + " row(s) deleted");
				}

				// READ demo
				System.out.print("Reading data from table, press ENTER to continue...");
				System.in.read();
				sql = "SELECT Id, Name, Location FROM Employees;";
				try (Statement statement = connection.createStatement();
						ResultSet resultSet = statement.executeQuery(sql)) {
					while (resultSet.next()) {
						System.out.println(
								resultSet.getInt(1) + " " + resultSet.getString(2) + " " + resultSet.getString(3));
					}
				}

				System.out.println("All done.");
			}
		} catch (Exception e) {
			System.out.println();
			e.printStackTrace();
		}
	}
}</code></pre>
<p>Build the project and create a jar package using the following command:</p>
<pre class="command-line" data-prompt="$"><code class="language-terminal">cd ~/SqlServerSample
mvn package</code></pre>
<pre><code class="language-results">[INFO] Scanning for projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building SqlServerSample 1.0.0
[INFO] ------------------------------------------------------------------------
...
[INFO] Building jar: /Users/usr1/SqlServerSample/target/SqlServerSample-1.0.0.jar
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 4.367 s
[INFO] Finished at: 2016-10-15T12:18:32-07:00
[INFO] Final Memory: 22M/208M
[INFO] ------------------------------------------------------------------------</code></pre>
<p>Now run the application. You can remove the of "-q" in the command below to show info messages from Maven.</p>
<pre class="command-line" data-prompt="$"><code class="language-terminal">mvn -q exec:java -Dexec.mainClass=com.sqlsamples.App</code></pre>
<pre><code class="language-results">Connect to SQL Server and demo Create, Read, Update and Delete operations.
Connecting to SQL Server ...
Done.
Dropping and creating database 'SampleDB' ... 
Done.
Creating sample table with data, press ENTER to continue...
Done.
Inserting a new row into table, press ENTER to continue...
1 row(s) inserted
Updating 'Location' for user 'Nikita', press ENTER to continue...
1 row(s) updated
Deleting user 'Jared', press ENTER to continue...
1 row(s) deleted
Reading data from table, press ENTER to continue...
2 Nikita United States
3 Tom Germany
4 Jake United States
All done.</code></pre>
{% endmacro %}
<!--Macro for a Java Hibernate app on Linux and Mac-->
{% macro javaHibernate()%}
<h4>Create a Java app that connects to SQL Server using the popular framework <a target="new" href="http://hibernate.org/orm/">Hibernate</a></h4>
<p>Change to your home directory. Create your Maven starter package. This will create the project directory with a basic Maven project and pom.xml file.</p>
<pre class="command-line" data-prompt="$"><code class="language-terminal">cd ~/
mvn archetype:generate -DgroupId=com.sqlsamples -DartifactId=SqlServerHibernateSample -DarchetypeArtifactId=maven-archetype-quickstart -Dversion=1.0.0</code></pre>
<pre><code class="language-results">[INFO] Scanning for projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building Maven Stub Project (No POM) 1
[INFO] ------------------------------------------------------------------------
...
[INFO] Generating project in Interactive mode
[INFO] Using property: groupId = com.sqlsamples
[INFO] Using property: artifactId = SqlServerHibernateSample
[INFO] Using property: version = 1.0.0
[INFO] Using property: package = com.sqlsamples
Confirm properties configuration:
groupId: com.sqlsamples
artifactId: SqlServerHibernateSample
version: 1.0.0
package: com.sqlsamples
 ...
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 4.124 s
[INFO] Finished at: 2016-10-15T12:33:17-07:00
[INFO] Final Memory: 14M/209M
[INFO] ------------------------------------------------------------------------</code></pre>
<p>Change directories into your newly created project.</p>
<pre class="command-line" data-prompt="$"><code class="language-terminal">cd ~/SqlServerHibernateSample </code></pre>
<p>Add the Microsoft JDBC Driver for SQL Server and Hibernate dependencies to your Maven project by opening your favorite text editor and copying and pasting the following lines into your <b>pom.xml</b> file. Do not overwrite the existing values prepopulated in the file. The JDBC and Hibernate dependencies must be pasted within the larger "dependencies" section (&ltdependency> &lt/dependency>).</p>
<p>Specify the version of Java to compile the project against by adding the "properties" section below into the pom.xml file. Add the &ltproperties> section below after the &ltdependencies> section. </p>
<p>Save and close the file. </p>
<pre><code class="language-xml">
&lt!-- prepopulated content by Maven -->
&ltdependencies>
    &ltdependency>
        &ltgroupId>com.microsoft.sqlserver&lt/groupId>
        &ltartifactId>mssql-jdbc&lt/artifactId>
        &ltversion>6.1.0.jre8&lt/version>
    &lt/dependency>
    &lt!-- your existing dependencies -->
&lt/dependencies>
&ltproperties>
    &ltmaven.compiler.source>1.8&lt/maven.compiler.source>
    &ltmaven.compiler.target>1.8&lt/maven.compiler.target>
    &lt!-- your existing properties -->
&lt/properties>  
&lt!-- prepopulated content by Maven --></code></pre>
<p>For this sample, let's create two tables. The first will hold data about "users". Create a <b>User.java</b> file in your Maven project located at: <i>~/SqlServerHibernateSample/src/main/java/com/sqlsamples/User.java</i></p>
<p>Copy and paste the code below into your newly created <b>User.java</b> file. Save and close the file. </p>
<pre><code class="language-java"> package com.sqlsamples;

import java.util.List;
import java.util.ArrayList;
import javax.persistence.*;

@Entity
@Table(name = "Users")
public class User {
	@Id
	@GeneratedValue(strategy = GenerationType.IDENTITY)
	private Long id;
	private String firstName;
	private String lastName;

	// Specify a 1:Many mapping between User and Task via the "user" field in
	// the "Tasks" class.
	@OneToMany(mappedBy = "user", cascade = CascadeType.ALL)
	private List&ltTask> tasks = new ArrayList&ltTask>();

	public User() {
	}

	public User(String firstName, String lastName) {
		this.firstName = firstName;
		this.lastName = lastName;
	}

	public Long getId() {
		return id;
	}

	public void setId(Long id) {
		this.id = id;
	}

	public String getFirstName() {
		return firstName;
	}

	public void setFirstName(String firstName) {
		this.firstName = firstName;
	}

	public String getLastName() {
		return lastName;
	}

	public void setLastName(String lastName) {
		this.lastName = lastName;
	}

	public String getFullName() {
		return this.firstName + " " + this.lastName;
	}

	public List&ltTask> getTasks() {
		return tasks;
	}

	public void setTasks(List&ltTask> tasks) {
		this.tasks = tasks;
	}

	@Override
	public String toString() {
		return "User [id=" + this.id + ", name=" + this.getFullName() + "]";
	}
}</code></pre>
<p>Let's create a second table to assign tasks to users. Create a <b>Task.java</b> file in your Maven project located at: <i>~/SqlServerHibernateSample/src/main/java/com/sqlsamples/Task.java</i>. </p>
<p>Copy and paste the code below into your newly created <b>Task.java</b> file. Save and close the file. </p>
<pre><code class="language-java">package com.sqlsamples;

import java.util.Date;
import javax.persistence.*;
import java.text.SimpleDateFormat;

@Entity
@Table(name = "Tasks")
public class Task {
	@Id
	@GeneratedValue(strategy = GenerationType.IDENTITY)
	private Long id;
	private String title;
	private Boolean isComplete;
	@Temporal(TemporalType.TIMESTAMP)
	private Date dueDate;

	// Specify a Many:1 mapping between Task and User
	@ManyToOne
	private User user;

	public Task() {
	}

	public Task(String title, Date dueDate) {
		this.title = title;
		this.dueDate = dueDate;
		this.isComplete = false;
	}

	public Task(String title, Date dueDate, User user) {
		this.title = title;
		this.dueDate = dueDate;
		this.isComplete = false;
		this.user = user;
	}

	public Long getId() {
		return id;
	}

	public void setId(Long id) {
		this.id = id;
	}

	public String getTitle() {
		return this.title;
	}

	public void setTitle(String title) {
		this.title = title;
	}

	public User getUser() {
		return this.user;
	}

	public void setUser(User user) {
		this.user = user;
	}

	public Date getDueDate() {
		return this.dueDate;
	}

	public void setDueDate(Date dueDate) {
		this.dueDate = dueDate;
	}

	@Override
	public String toString() {
		SimpleDateFormat ft = new SimpleDateFormat("E yyyy.MM.dd 'at' hh:mm:ss a zzz");
		return "Task [id=" + this.id + ", title=" + this.title + ", dueDate=" + ft.format(this.dueDate)
				+ ", isComplete=" + this.isComplete.toString() + "]";
	}
}</code></pre>
<p>Replace the code in the <b>App.java</b> file in your Maven project located at: <i>~/SqlServerHibernateSample/src/main/java/com/sqlsamples/App.java</i>. </p>
<p>Open this file in your favorite text editor and replace the contents with the code below. Don't forget to update the username and password with your own. Save and close the file. </p>
<pre><code class="language-java">package com.sqlsamples;

import java.sql.Connection;
import java.sql.Statement;
import java.sql.DriverManager;
import java.text.SimpleDateFormat;
import java.util.List;
import org.hibernate.Session;
import org.hibernate.SessionFactory;
import org.hibernate.cfg.Configuration;

/**
 * Java CRUD sample with Hibernate and SQL Server
 *
 */
public class App {
	String connectionUrl = "jdbc:sqlserver://localhost:1433"; // update me
	String userName = "sa"; // update me
	String password = "your_password"; // update me
	String sampleDatabaseName = "SampleDB";

	// Main entry point
	public static void main(String[] args) {
		App app = new App();
		app.runDemo();
	}

	// Helper to run the demp app
	public void runDemo()
    {
        // Configure Hibernate logging to only log SEVERE errors
        @SuppressWarnings("unused")
        org.jboss.logging.Logger logger = org.jboss.logging.Logger.getLogger("org.hibernate");
        java.util.logging.Logger.getLogger("org.hibernate").setLevel(java.util.logging.Level.SEVERE);

        System.out.println("**Java CRUD sample with Hibernate and SQL Server **\n");
		try {
            // We're creating the Hibernate configuration via code. An alternative is to use a 'hibernate.cfg.xml' file.
            Configuration cfg = createHibernateConfiguration();

            // We're mapping POJO classes to Tables via Hibernate Annotations. An alternative is to use Hibernate mapping xml files.
            cfg.addAnnotatedClass(User.class);
            cfg.addAnnotatedClass(Task.class);

            // Hibernate needs an existing database. Use JDBC to create one for this sample.
            createSampleDatabase();

            // Create the Hibernate SessionFactory and Session.
            // This causes Hibernate to create Tables and Relationships in the database from our Annotated classes.
            try (SessionFactory sessionFactory = cfg.buildSessionFactory();
                 Session session = sessionFactory.openSession()) {

                System.out.println("Created database schema from Java classes.\n");
                session.beginTransaction();

                // Create demo: Create a User instance and save it to the database
                User newUser = new User("Anna", "Shrestinian");
                session.save(newUser);
                System.out.println("Created User: " + newUser.toString());

                // Create demo: Create a Task instance and save it to the database
                SimpleDateFormat sdf = new SimpleDateFormat("MM-dd-yyyy");
                Task newTask = new Task("Ship Helsinki", sdf.parse("04-01-2017"));
                session.save(newTask);
                System.out.println("Created Task: " + newTask.toString());

                // Association demo: Assign task to user
                newTask.setUser(newUser);
                session.save(newTask);
                System.out.println("Assigned Task: '" + newTask.getTitle() + "' to user '" + newUser.getFullName() + "'\n");

                // Read demo: find incomplete tasks assigned to user 'Anna'
                System.out.println("Incomplete tasks assigned to 'Anna':");
                String hqlQuery = "from Task where isComplete = false and user.firstName = :paramFirstName";
                List&ltTask> incompleteTasks = session.createQuery(hqlQuery, Task.class)
                                             .setParameter("paramFirstName", "Anna")
                                             .getResultList();
                for(Task theTask : incompleteTasks) {
                    System.out.println(theTask.toString());
                }

                // Update demo: change the 'dueDate' of a task
                hqlQuery = "from Task";
                Task taskToUpdate = session.createQuery(hqlQuery, Task.class)
                                    .getResultList()
                                    .get(0); // get the first task
                System.out.println("\nUpdating task: " + taskToUpdate.toString());
                taskToUpdate.setDueDate(sdf.parse("06-30-2016"));
                session.save(taskToUpdate);
                System.out.println("dueDate changed: " + taskToUpdate.toString());

                // Delete demo: delete all tasks with a dueDate in 2016
                System.out.println("\nDeleting all tasks with a dueDate in 2016");
                hqlQuery = "from Task where dueDate < :paramDate";
                List&ltTask> tasksToDelete = session.createQuery(hqlQuery, Task.class)
                                           .setParameter("paramDate", sdf.parse("12-31-2016"))
                                           .getResultList();
                for(Task theTask : tasksToDelete) {
                    System.out.println("Deleting task:" + theTask.toString());
                    session.delete(theTask);
                }

                // Show tasks after the 'Delete' operation - there should be 0 tasks
                System.out.println("\nTasks after delete:");
                hqlQuery = "from Task";
                List&ltTask> tasksAfterDelete = session.createQuery(hqlQuery, Task.class)
                                              .getResultList();
                if(tasksAfterDelete.isEmpty()) {
                    System.out.println("[None]");
                }
                else {
                    for(Task theTask : tasksAfterDelete) {
                        System.out.println(theTask.toString());
                    }
                }

                session.getTransaction().commit();
            }
            System.out.println("All done.");

        } catch (Exception e) {
            System.out.println();
            e.printStackTrace();
        }
    }

	// Hibernate needs an existing database. Use JDBC to create one for this
	// sample.
	private void createSampleDatabase() throws java.sql.SQLException {
		// Load SQL Server JDBC driver and establish connection.
		String url = this.connectionUrl + ";databaseName=master;" + "user=" + this.userName + ";password="
				+ this.password;
		System.out.print("Connecting to SQL Server ... ");
		try (Connection connection = DriverManager.getConnection(url)) {
			System.out.println("Done.");

			// Create a sample database
			System.out.print("Dropping and creating database '" + this.sampleDatabaseName + "' ... ");
			String sql = "DROP DATABASE IF EXISTS [" + this.sampleDatabaseName + "]; CREATE DATABASE ["
					+ this.sampleDatabaseName + "]";
			try (Statement statement = connection.createStatement()) {
				statement.executeUpdate(sql);
				System.out.println("Done.\n");
			}
		}
	}

	// Create Hibernate configuration via code instead of using a
	// 'hibernate.cfg.xml' file.
	private Configuration createHibernateConfiguration() {
		String url = this.connectionUrl + ";databaseName=" + this.sampleDatabaseName;
        Configuration cfg = new Configuration()
				.setProperty("hibernate.connection.driver_class", "com.microsoft.sqlserver.jdbc.SQLServerDriver")
				.setProperty("hibernate.connection.url", url)
				.setProperty("hibernate.connection.username", this.userName)
				.setProperty("hibernate.connection.password", this.password)
				.setProperty("hibernate.connection.autocommit", "true")
				.setProperty("hibernate.show_sql", "false");

		// Tell Hibernate to use the 'SQL Server' dialect when dynamically
		// generating SQL queries
		cfg.setProperty("hibernate.dialect", "org.hibernate.dialect.SQLServerDialect");

		// Tell Hibernate to show the generated T-SQL
		cfg.setProperty("hibernate.show_sql", "false");

		// This is ok during development, but not recommended in production
		// See: http://stackoverflow.com/questions/221379/hibernate-hbm2ddl-auto-update-in-production
		cfg.setProperty("hibernate.hbm2ddl.auto", "update");
		return cfg;
	}
}</code></pre>
<p>Build the project and create a jar package using the following command:</p>
<pre class="command-line" data-prompt="$"><code class="language-terminal">cd ~/SqlServerHibernateSample
mvn package</code></pre>
<pre><code class="language-results">[INFO] Scanning for projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building SqlServerHibernateSample 1.0.0
[INFO] ------------------------------------------------------------------------
...
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 1.555 s
[INFO] Finished at: 2016-10-15T12:59:27-07:00
[INFO] Final Memory: 11M/155M
[INFO] ------------------------------------------------------------------------</code></pre>
<p>Now run the application. You can remove the of "-q" in the command below to show info messages from Maven.</p>
<pre class="command-line" data-prompt="$"><code class="language-terminal">mvn -q exec:java -Dexec.mainClass=com.sqlsamples.App</code></pre>
<pre><code class="language-results">**Java CRUD sample with Hibernate and SQL Server **

Connecting to SQL Server ... Done.
Dropping and creating database 'HibernateSampleDB' ... Done.

Created database schema from Java classes.

Created User: User [id=1, name=Anna Shrestinian]
Created Task: Task [id=1, title=Ship Helsinki, dueDate=Sat 2017.04.01 at 12:00:00 AM PDT, isComplete=false]
Assigned Task: 'Ship Helsinki' to user 'Anna Shrestinian'

Incomplete tasks assigned to 'Anna':
Task [id=1, title=Ship Helsinki, dueDate=Sat 2017.04.01 at 12:00:00 AM PDT, isComplete=false]

Updating task: Task [id=1, title=Ship Helsinki, dueDate=Sat 2017.04.01 at 12:00:00 AM PDT, isComplete=false]
dueDate changed: Task [id=1, title=Ship Helsinki, dueDate=Thu 2016.06.30 at 12:00:00 AM PDT, isComplete=false]

Deleting all tasks with a dueDate in 2016
Deleting task:Task [id=1, title=Ship Helsinki, dueDate=Thu 2016.06.30 at 12:00:00 AM PDT, isComplete=false]

Tasks after delete:
[None]
All done.</code></pre>
{% endmacro %}
<!--Macro for a Java Columnstore app on Linux and Mac-->
{% macro javaColumnstore()%}
{{macros.columnstoreSP1()}}   
<p>To showcase the capabilities of Columnstore indexes, let's create a Java application that creates a sample database and a sample table with 5 million rows and then runs a simple query before and after adding a Columnstore index.</p>
<p>Change to your home directory. Create your Maven starter package. This will create the project directory with a basic Maven project and pom.xml file.</p>
<pre class="command-line" data-prompt="$"><code class="language-terminal">cd ~/
mvn archetype:generate -DgroupId=com.sqlsamples -DartifactId=SqlServerColumnstoreSample -DarchetypeArtifactId=maven-archetype-quickstart -Dversion=1.0.0</code></pre>
<pre><code class="language-results">[INFO] Scanning for projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building Maven Stub Project (No POM) 1
[INFO] ------------------------------------------------------------------------
...
[INFO] Generating project in Interactive mode
[INFO] Using property: groupId = com.sqlsamples
[INFO] Using property: artifactId = SqlServerColumnstoreSample
[INFO] Using property: version = 1.0.0
[INFO] Using property: package = com.sqlsamples
Confirm properties configuration:
groupId: com.sqlsamples
artifactId: SqlServerColumnstoreSample
version: 1.0.0
package: com.sqlsamples
...
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 18.520 s
[INFO] Finished at: 2016-10-15T13:49:20-07:00
[INFO] Final Memory: 14M/208M
[INFO] ------------------------------------------------------------------------</code></pre>
<p>Add the Microsoft JDBC Driver for SQL Server dependency to your Maven project by opening your favorite text editor and copying and pasting the following lines into your <b>pom.xml</b> file. Do not overwrite the existing values prepopulated in the file. The JDBC dependency must be pasted within the larger "dependencies" section (&ltdependency> &lt/dependency>).</p>
<p>Specify the version of Java to compile the project against by adding the "properties" section below into the pom.xml file. Add the &ltproperties> section below after the &ltdependencies> section. </p>
<p>Save and close the file. </p>
<pre><code class="language-xml">
&lt!-- prepopulated content by Maven -->
&ltdependencies>
    &ltdependency>
        &ltgroupId>com.microsoft.sqlserver&lt/groupId>
        &ltartifactId>mssql-jdbc&lt/artifactId>
        &ltversion>6.1.0.jre8&lt/version>
    &lt/dependency>
    &lt!-- your existing dependencies -->
&lt/dependencies>
&ltproperties>
    &ltmaven.compiler.source>1.8&lt/maven.compiler.source>
    &ltmaven.compiler.target>1.8&lt/maven.compiler.target>
    &lt!-- your existing properties -->
&lt/properties>  
&lt!-- prepopulated content by Maven --></code></pre>
<p>Change directories into your newly created project.</p>
<pre class="command-line" data-prompt="$"><code class="language-terminal">cd ~/SqlServerColumnstoreSample </code></pre>
<p>You should already have a file called <b>App.java</b> in your Maven project located at: <i>~/SqlServerColumnstoreSample/src/main/java/com/sqlsamples/App.java</i></p>
<p>Open this file in your favorite text editor and replace the contents with the code below. Don't forget to update the username and password with your own. Save and close the file. </p>
<pre><code class="language-java">package com.sqlsamples;

import java.math.BigDecimal;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.Statement;

public class App {

	public static void main(String[] args) {

		System.out.println("*** SQL Server Columnstore demo ***");

		// Update the username and password below
		String connectionUrl = "jdbc:sqlserver://localhost:1433;databaseName=master;user=sa;password=your_password";

		// Load SQL Server JDBC driver and establish connection.
		try {
			// Load SQL Server JDBC driver and establish connection.
			System.out.print("Connecting to SQL Server ... ");
			try (Connection connection = DriverManager.getConnection(connectionUrl)) {
				System.out.println("Done.");

				// Create an example database
				System.out.print("Dropping and creating database 'SampleDB' ... ");
				String sql = "DROP DATABASE IF EXISTS [SampleDB]; CREATE DATABASE [SampleDB]";
				try (Statement statement = connection.createStatement()) {
					statement.executeUpdate(sql);
					System.out.println("Done.");
				}
				// Insert 5 million rows into the table 'Table_with_5M_rows'
				System.out.print(
						"Inserting 5 million rows into table 'Table_with_5M_rows'. This takes ~1 minute, please wait ... ");
				sql = new StringBuilder().append("USE SampleDB; ")
						.append("WITH a AS (SELECT * FROM (VALUES(1),(2),(3),(4),(5),(6),(7),(8),(9),(10)) AS a(a))")
						.append("SELECT TOP(5000000)").append("ROW_NUMBER() OVER (ORDER BY a.a) AS OrderItemId ")
						.append(",a.a + b.a + c.a + d.a + e.a + f.a + g.a + h.a AS OrderId ")
						.append(",a.a * 10 AS Price ")
						.append(",CONCAT(a.a, N' ', b.a, N' ', c.a, N' ', d.a, N' ', e.a, N' ', f.a, N' ', g.a, N' ', h.a) AS ProductName ")
						.append("INTO Table_with_5M_rows ")
						.append("FROM a, a AS b, a AS c, a AS d, a AS e, a AS f, a AS g, a AS h;").toString();
				try (Statement statement = connection.createStatement()) {
					statement.executeUpdate(sql);
					System.out.println("Done.");
				}

				// Execute SQL query without a columnstore index
				long elapsedTimeWithoutIndex = SumPrice(connection);
				System.out.println("Query time WITHOUT columnstore index: " + elapsedTimeWithoutIndex + "ms");

				System.out.print("Adding a columnstore to table 'Table_with_5M_rows'  ... ");
				sql = "CREATE CLUSTERED COLUMNSTORE INDEX columnstoreindex ON Table_with_5M_rows;";
				try (Statement statement = connection.createStatement()) {
					statement.executeUpdate(sql);
					System.out.println("Done.");
				}

				// Execute the same SQL query again after the columnstore index
				// is added
				long elapsedTimeWithIndex = SumPrice(connection);
				System.out.println("Query time WITH columnstore index: " + elapsedTimeWithIndex + "ms");

				// Calculate performance gain from adding columnstore index
				System.out.println("Performance improvement with columnstore index: "
						+ elapsedTimeWithoutIndex / elapsedTimeWithIndex + "x!");

			}
		} catch (Exception e) {
			System.out.println("");
			e.printStackTrace();
		}
	}

	public static long SumPrice(Connection connection) {
		String sql = "SELECT SUM(Price) FROM Table_with_5M_rows;";
		long startTime = System.currentTimeMillis();
		try (Statement statement = connection.createStatement(); ResultSet resultSet = statement.executeQuery(sql)) {
			while (resultSet.next()) {
				long elapsedTime = System.currentTimeMillis() - startTime;
				return elapsedTime;
			}
		} catch (Exception e) {
			System.out.println("");
			e.printStackTrace();
		}
		return 0;
	}
}</code></pre>
<p>Build the project and create a jar package using the following command:</p>
<pre class="command-line" data-prompt="$"><code class="language-terminal">cd ~/SqlServerColumnstoreSample
mvn package</code></pre>
<pre><code class="language-results">[INFO] Scanning for projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building SqlServerColumnstoreSample 1.0.0
[INFO] ------------------------------------------------------------------------
...
[INFO] Building jar: /Users/usr1/SqlServerColumnstoreSample/target/SqlServerColumnstoreSample-1.0.0.jar
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 2.173 s
[INFO] Finished at: 2016-10-15T13:59:15-07:00
[INFO] Final Memory: 17M/207M
[INFO] ------------------------------------------------------------------------</code></pre>
<p>Now run the application. You can remove the of "-q" in the command below to show info messages from Maven.</p>
<pre class="command-line" data-prompt="$"><code class="language-terminal">mvn -q exec:java -Dexec.mainClass=com.sqlsamples.App</code></pre>
<pre><code class="language-results">*** SQL Server Columnstore demo ***
Connecting to SQL Server ... Done.
Dropping and creating database 'SampleDB' ... Done.
Inserting 5 million rows into table 'Table_with_5M_rows'. This takes ~1 minute, please wait ... Done.
Query time WITHOUT columnstore index: 363ms                                                                                                                                                                                                                
Adding a columnstore to table 'Table_with_5M_rows'  ... Done.                                                                                                                                                                                                 
Query time WITH columnstore index: 5ms                                                                                                                                                                                                                    
Performance improvement with columnstore index: 71x! </code></pre>

<p><img src="https://deve2e.azureedge.net/sqlchoice/static/images/completeStar.png" alt="goldstar" style="width:25px;height:25px;"> The performance of the query was greatly improved!
                            <br>Now that you've built a few Java apps with SQL Server and Maven, continue checking out other SQL Server features.</p>
{% endmacro %}


{% macro discus() %}
<br></br>
<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//sqlchoice.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
               
{% endmacro %}