<!--PHP Macros-->
<!--Macro for a PHP CRUD example on Ubuntu -->
{% import "macros.html" as macros %}
{% macro phpCRUD() %}
<h4>Create a PHP app that connects to SQL Server and executes queries</h4>
<p>Install the Microsoft PHP Driver for SQL Server and its prerequisites</p>
<pre class="command-line" data-prompt="$"><code class="language-terminal">
sudo su 
curl https://packages.microsoft.com/keys/microsoft.asc | apt-key add -
curl https://packages.microsoft.com/config/ubuntu/16.04/prod.list > /etc/apt/sources.list.d/mssql-release.list
exit
sudo apt-get update
sudo ACCEPT_EULA=Y apt-get install msodbcsql
sudo apt-get install unixodbc-dev gcc g++ build-essential 
sudo pecl install sqlsrv pdo_sqlsrv
sudo echo "extension= pdo_sqlsrv.so" >> `php --ini | grep "Loaded Configuration" | sed -e "s|.*:\s*||"`
sudo echo "extension= sqlsrv.so" >> `php --ini | grep "Loaded Configuration" | sed -e "s|.*:\s*||"`
</code></pre>
<p>Create a database that will be used for the rest of this tutorial by connecting to SQL Server using sqlcmd and executing the following statement. Don't forget to update the username and password with your own.</p>
<pre class="command-line language-terminal" data-prompt="$"><code class="language-terminal">sqlcmd -S localhost -U sa -P your_password -Q "CREATE DATABASE SampleDB;"</code></pre>
<p>In your home directory, create a new folder <i>SqlServerSample</i>.</p>
<pre class="command-line" data-prompt="$"><code class="language-terminal">mkdir SqlServerSample
cd SqlServerSample
</code></pre>
<p> Using your favorite text editor, create a new file called <b>connect.php</b> in the <i>SqlServerSample</i> folder. Paste the code below inside into the new file. Don't forget to update the username and password with your own. Save and close the file.  </p>
<pre><code class="language-php">
&lt;?php
    $serverName = "localhost";
    $connectionOptions = array(
        "Database" => "SampleDB",
        "Uid" => "sa",
        "PWD" => "your_password"
    );
    //Establishes the connection
    $conn = sqlsrv_connect($serverName, $connectionOptions);
    if($conn)
        echo "Connected!"
?&gt;
 </code></pre>
<p>Run your PHP script from the terminal.</p>
<pre class="command-line language-terminal" data-prompt="$"><code class="language-terminal">php connect.php</code></pre>
<pre><code class="language-results">Connected!
</code></pre>
<p>Execute the T-SQL scripts below in the terminal with sqlcmd to create a <a href="https://msdn.microsoft.com/en-us/library/aa578080.aspx">schema</a>, <a href="https://msdn.microsoft.com/en-us/library/ms189084.aspx">table</a>, and <a href="https://msdn.microsoft.com/en-us/library/ms174335.aspx">insert</a> a few rows.</p>
{{macros.sqlcmdLinux()}}

<p>Using your favorite text editor, create a new file called <b>crud.php</b> in the <i>SqlServerSample</i> folder. Paste the code below inside into the new file. This will <a href="https://msdn.microsoft.com/en-us/library/ms174335.aspx">insert</a>, <a href="https://msdn.microsoft.com/en-us/library/ms177523.aspx">update</a>, <a href="https://msdn.microsoft.com/en-us/library/ms189835.aspx">delete</a>, and <a href="https://msdn.microsoft.com/en-us/library/ms189499.aspx">read</a> a few rows. Don't forget to update the username and password with your own. Save and close the file. </p>
<pre><code class="language-php">
&lt;?php
$serverName = "localhost";
$connectionOptions = array(
    "Database" => "SampleDB",
    "Uid" => "sa",
    "PWD" => "your_password"
);
//Establishes the connection
$conn = sqlsrv_connect($serverName, $connectionOptions);

//Insert Query
echo ("Inserting a new row into table" . PHP_EOL);
$tsql= "INSERT INTO TestSchema.Employees (Name, Location) VALUES (?,?);";
$params = array('Jake','United States');  
$getResults= sqlsrv_query($conn, $tsql, $params);
$rowsAffected = sqlsrv_rows_affected($getResults);  
if ($getResults == FALSE or $rowsAffected == FALSE)
    die(FormatErrors(sqlsrv_errors()));
echo ($rowsAffected. " row(s) inserted: " . PHP_EOL);

sqlsrv_free_stmt($getResults);

//Update Query

$userToUpdate = 'Nikita';
$tsql= "UPDATE TestSchema.Employees SET Location = ? WHERE Name = ?";
$params = array('Sweden', $userToUpdate); 
echo("Updating Location for user " . $userToUpdate . PHP_EOL);

$getResults= sqlsrv_query($conn, $tsql, $params);
$rowsAffected = sqlsrv_rows_affected($getResults);  
if ($getResults == FALSE or $rowsAffected == FALSE)
    die(FormatErrors(sqlsrv_errors()));
echo ($rowsAffected. " row(s) updated: " . PHP_EOL);
sqlsrv_free_stmt($getResults);

//Delete Query
$userToDelete = 'Jared';
$tsql= "DELETE FROM TestSchema.Employees WHERE Name = ?";
$params = array($userToDelete); 
$getResults= sqlsrv_query($conn, $tsql, $params);
echo("Deleting user " . $userToDelete . PHP_EOL);
$rowsAffected = sqlsrv_rows_affected($getResults);  
if ($getResults == FALSE or $rowsAffected == FALSE)
    die(FormatErrors(sqlsrv_errors()));
echo ($rowsAffected. " row(s) deleted: " . PHP_EOL);
sqlsrv_free_stmt($getResults);


//Read Query
$tsql= "SELECT Id, Name, Location FROM TestSchema.Employees;";
$getResults= sqlsrv_query($conn, $tsql);
echo ("Reading data from table" . PHP_EOL);
if ($getResults == FALSE)
    die(FormatErrors(sqlsrv_errors()));
while ($row = sqlsrv_fetch_array($getResults, SQLSRV_FETCH_ASSOC)) {
    echo ($row['Id'] . " " . $row['Name'] . " " . $row['Location'] . PHP_EOL);

}
sqlsrv_free_stmt($getResults);

function FormatErrors( $errors )  
{  
    /* Display errors. */  
    echo "Error information: <br/>";  
  
    foreach ( $errors as $error )  
    {  
        echo "SQLSTATE: ".$error['SQLSTATE']."<br/>";  
        echo "Code: ".$error['code']."<br/>";  
        echo "Message: ".$error['message']."<br/>";  
    }  
}  
?&gt;
</code></pre>
<p>Run your PHP script from the terminal.</p>
<pre class="command-line language-terminal" data-prompt="$"><code class="language-terminal">php crud.php</code></pre>
<pre><code class="language-results">
Inserting a new row into table
1 row(s) inserted: 
Updating Location for user Nikita
1 row(s) updated: 
Deleting user Jared
1 row(s) deleted: 
Reading data from table
2 Nikita Sweden
3 Tom Germany
4 Jake United States
</code></pre>
{% endmacro %}

<!--Macro for a PHP Columnstore example on Linux -->
{% macro phpColumnstore()%}
{{macros.columnstoreSP1()}}   
<p>To showcase the capabilities of Columnstore Indexes, let's create a table with 5 million rows using your favorite tool. The following T-SQL code will create a table with 5,000,000 rows of random data.</p>
<pre class="command-line language-terminal" data-output="2-100"data-prompt="$"><code class="language-terminal">sqlcmd -S localhost -U sa -P your_password -d SampleDB -t 60000 -Q "WITH a AS (SELECT * FROM (VALUES(1),(2),(3),(4),(5),(6),(7),(8),(9),(10)) AS a(a))
SELECT TOP(5000000)
ROW_NUMBER() OVER (ORDER BY a.a) AS OrderItemId
,a.a + b.a + c.a + d.a + e.a + f.a + g.a + h.a AS OrderId 
,a.a * 10 AS Price
,CONCAT(a.a, N' ', b.a, N' ', c.a, N' ', d.a, N' ', e.a, N' ', f.a, N' ', g.a, N' ', h.a) AS ProductName
INTO Table_with_5M_rows
FROM a, a AS b, a AS c, a AS d, a AS e, a AS f, a AS g, a AS h;"</code></pre>
<p>Next, let's create a PHP application that runs a simple query. </p>
<pre class="command-line"  data-output="1,3" data-prompt="$"><code class="language-terminal">#Change to home directory
cd ~/ 
#Create a project directory
mkdir SqlServerColumnstoreSample
cd SqlServerColumnstoreSample
</code></pre>
<p>Using your favorite text editor, create a new file called <b>columnstore.php</b> in the <i>SqlServerColumnstoreSample</i> folder. Paste the following code inside it. Don't forget to replace the username and password with your own. Save and close the file. </p>
<pre><code class="language-php">
&lt;?php
$time_start = microtime(true);

$serverName = "localhost";
$connectionOptions = array(
    "Database" => "SampleDB",
    "Uid" => "sa",
    "PWD" => "your_password"
);
//Establishes the connection
$conn = sqlsrv_connect($serverName, $connectionOptions);

//Read Query
$tsql= "SELECT SUM(Price) as sum FROM Table_with_5M_rows";
$getResults= sqlsrv_query($conn, $tsql);
echo ("Sum: ");
if ($getResults == FALSE)
    die(FormatErrors(sqlsrv_errors()));
while ($row = sqlsrv_fetch_array($getResults, SQLSRV_FETCH_ASSOC)) {
    echo ($row['sum'] . PHP_EOL);

}
sqlsrv_free_stmt($getResults);

function FormatErrors( $errors )  
{  
    /* Display errors. */  
    echo "Error information: <br/>";  
  
    foreach ( $errors as $error )  
    {  
        echo "SQLSTATE: ".$error['SQLSTATE']."<br/>";  
        echo "Code: ".$error['code']."<br/>";  
        echo "Message: ".$error['message']."<br/>";  
    }  
}
$time_end = microtime(true);
$execution_time = round((($time_end - $time_start)*1000),2);
echo 'QueryTime: '.$execution_time.' ms';

  
?&gt;

</code></pre>
<p>Run the PHP script from the terminal.</p>
<pre class="command-line language-terminal" data-prompt="$"><code class="language-terminal">php columnstore.php</code></pre>
<pre><code class="language-results">Sum: 50000000 
QueryTime: 363ms</code></pre>
<p>Now let's add a columnstore index to your table.</p>
<pre class="command-line language-terminal" data-prompt="$"><code class="language-terminal">sqlcmd -S localhost -U sa -P your_password -d SampleDB -Q "CREATE CLUSTERED COLUMNSTORE INDEX Columnstoreindex ON Table_with_5M_rows;"</code></pre>
<p>Re-run the columnstore.php script and notice how long the query took to complete this time.</p>
<pre class="command-line language-terminal" data-prompt="$"><code class="language-terminal">php columnstore.php</code></pre>
<pre><code class="language-results">Sum: 50000000 
QueryTime: 5ms</code></pre>

<p><img src="https://deve2e.azureedge.net/sqlchoice/static/images/completeStar.png" alt="goldstar" style="width:25px;height:25px;"> The performance of the query was greatly improved!
<br>Now that you've built a few PHP apps with SQL Server, continue checking out other SQL Server features.
{% endmacro %}

<!--Macro for a PHP CRUD app on Windows -->
{% macro phpCRUDWindows() %}
<h4>Create a PHP app that connects to SQL Server and executes queries</h4>
<p>Install the Microsoft PHP Driver for SQL Server and its prerequisites. To do so, open up cmd as administrator</p>
<pre class="command-line" data-prompt=">"><code class="language-terminal">
choco install -y wget
cd C:\Program^ Files\iis^ express\PHP\v7.0\ext
wget "http://aka.ms/php_sqlsrv_7_nts.dll"
wget "https://aka.ms/php_pdo_sqlsrv_7_nts.dll"
echo extension=php_sqlsrv_7_nts.dll >> C:\Program^ Files\iis^ express\PHP\v7.0\php.ini
echo extension=php_pdo_sqlsrv_7_nts.dll >> C:\Program^ Files\iis^ express\PHP\v7.0\php.ini
</code></pre>

<p>Create a database that will be used for the rest of this tutorial by connecting to SQL Server using sqlcmd and executing the following statement. Don't forget to update the username and password with your own.</p>
<pre class="command-line language-terminal" data-prompt=">"><code class="language-terminal">sqlcmd -S localhost -U sa -P your_password -Q "CREATE DATABASE SampleDB;"</code></pre>
<p>In your home directory, create a new folder called <i>SqlServerSample</i>.</p>
<pre class="command-line" data-prompt=">"><code class="language-terminal">
mkdir SqlServerSample
cd SqlServerSample
</code></pre>
<p> Using your favorite text editor, create a new file called <b>connect.php</b> in the <i>SqlServerSample</i> folder. Paste the code below inside into the new file. Don't forget to update the username and password with your own. Save and close the file. </p>
    
<pre><code class="language-php">
&lt;?php
$serverName = "localhost";
$connectionOptions = array(
    "Database" => "SampleDB",
    "Uid" => "sa",
    "PWD" => "your_password"
);
//Establishes the connection
$conn = sqlsrv_connect($serverName, $connectionOptions);
if($conn)
    echo "Connected!"
?&gt;
 </code></pre>
<p>Run your PHP script from the terminal.</p>
<pre class="command-line language-terminal" data-prompt=">"><code class="language-terminal">php connect.php</code></pre>
<pre><code class="language-results">Connected!
</code></pre>
<p>Execute the T-SQL scripts below in the terminal with sqlcmd to create a <a href="https://msdn.microsoft.com/en-us/library/aa578080.aspx">schema</a>, <a href="https://msdn.microsoft.com/en-us/library/ms189084.aspx">table</a>, and <a href="https://msdn.microsoft.com/en-us/library/ms174335.aspx">insert</a> a few rows. Don't forget to update the username and password with your own.</p>
{{macros.sqlcmdWindows()}}

<p>Using your favorite text editor, create a new file called <b>crud.php</b> in the <i>SqlServerSample</i> folder. Paste the code below inside into the new file. This will <a href="https://msdn.microsoft.com/en-us/library/ms174335.aspx">insert</a>, <a href="https://msdn.microsoft.com/en-us/library/ms177523.aspx">update</a>, <a href="https://msdn.microsoft.com/en-us/library/ms189835.aspx">delete</a>, and <a href="https://msdn.microsoft.com/en-us/library/ms189499.aspx">read</a> a few rows. Don't forget to update the username and password with your own. Save and close the file. </p>
<pre><code class="language-php">
&lt;?php
$serverName = "localhost";
$connectionOptions = array(
    "Database" => "SampleDB",
    "Uid" => "sa",
    "PWD" => "your_password"
);
//Establishes the connection
$conn = sqlsrv_connect($serverName, $connectionOptions);

//Insert Query
echo ("Inserting a new row into table" . PHP_EOL);
$tsql= "INSERT INTO TestSchema.Employees (Name, Location) VALUES (?,?);";
$params = array('Jake','United States');  
$getResults= sqlsrv_query($conn, $tsql, $params);
$rowsAffected = sqlsrv_rows_affected($getResults);  
if ($getResults == FALSE or $rowsAffected == FALSE)
    die(FormatErrors(sqlsrv_errors()));
echo ($rowsAffected. " row(s) inserted: " . PHP_EOL);

sqlsrv_free_stmt($getResults);

//Update Query

$userToUpdate = 'Nikita';
$tsql= "UPDATE TestSchema.Employees SET Location = ? WHERE Name = ?";
$params = array('Sweden', $userToUpdate); 
echo("Updating Location for user " . $userToUpdate . PHP_EOL);

$getResults= sqlsrv_query($conn, $tsql, $params);
$rowsAffected = sqlsrv_rows_affected($getResults);  
if ($getResults == FALSE or $rowsAffected == FALSE)
    die(FormatErrors(sqlsrv_errors()));
echo ($rowsAffected. " row(s) updated: " . PHP_EOL);
sqlsrv_free_stmt($getResults);

//Delete Query
$userToDelete = 'Jared';
$tsql= "DELETE FROM TestSchema.Employees WHERE Name = ?";
$params = array($userToDelete); 
$getResults= sqlsrv_query($conn, $tsql, $params);
echo("Deleting user " . $userToDelete . PHP_EOL);
$rowsAffected = sqlsrv_rows_affected($getResults);  
if ($getResults == FALSE or $rowsAffected == FALSE)
    die(FormatErrors(sqlsrv_errors()));
echo ($rowsAffected. " row(s) deleted: " . PHP_EOL);
sqlsrv_free_stmt($getResults);


//Read Query
$tsql= "SELECT Id, Name, Location FROM TestSchema.Employees;";
$getResults= sqlsrv_query($conn, $tsql);
echo ("Reading data from table" . PHP_EOL);
if ($getResults == FALSE)
    die(FormatErrors(sqlsrv_errors()));
while ($row = sqlsrv_fetch_array($getResults, SQLSRV_FETCH_ASSOC)) {
    echo ($row['Id'] . " " . $row['Name'] . " " . $row['Location'] . PHP_EOL);

}
sqlsrv_free_stmt($getResults);

function FormatErrors( $errors )  
{  
    /* Display errors. */  
    echo "Error information: <br/>";  
  
    foreach ( $errors as $error )  
    {  
        echo "SQLSTATE: ".$error['SQLSTATE']."<br/>";  
        echo "Code: ".$error['code']."<br/>";  
        echo "Message: ".$error['message']."<br/>";  
    }  
}  
?&gt;
</code></pre>
<p>Run your PHP script from the terminal.</p>
<pre class="command-line language-terminal" data-prompt=">"><code class="language-terminal">php crud.php</code></pre>
<pre><code class="language-results">
Inserting a new row into table
1 row(s) inserted:
Updating Location for user Nikita
1 row(s) updated:
Deleting user Jared
1 row(s) deleted:
Reading data from table
2 Nikita Sweden
3 Tom Germany
4 Jake United States
</code></pre>
{% endmacro %}

<!--Macro for a  PHP Columnstore app on Windows -->
{% macro phpColumnstoreWindows()%}
{{macros.columnstoreSP1()}}   
<p>To showcase the capabilities of Columnstore Indexes, let's create a table with 5 million rows using your favorite tool. The following T-SQL code will create a table with 5,000,000 rows of random data.</p>
<p>In your home directory, create a folder for your project.</p>
<pre class="command-line" data-prompt=">"><code class="language-terminal">mkdir SqlServerColumnstoreSample
cd SqlServerColumnstoreSample
</code></pre>
<p>Using your favorite text editor, create a new file called <b>CreateSampleTable.sql</b> in the folder <i>SqlServerColumnstoreSample</i>. Paste the T-SQL code below into your new SQL file. Save and close the file.   </p>
<pre><code class="language-SQL"> WITH a AS (SELECT * FROM (VALUES(1),(2),(3),(4),(5),(6),(7),(8),(9),(10)) AS a(a))
SELECT TOP(5000000)
ROW_NUMBER() OVER (ORDER BY a.a) AS OrderItemId
,a.a + b.a + c.a + d.a + e.a + f.a + g.a + h.a AS OrderId 
,a.a * 10 AS Price
,CONCAT(a.a, N' ', b.a, N' ', c.a, N' ', d.a, N' ', e.a, N' ', f.a, N' ', g.a, N' ', h.a) AS ProductName
INTO Table_with_5M_rows
FROM a, a AS b, a AS c, a AS d, a AS e, a AS f, a AS g, a AS h;</code></pre>
<p>Run the SQL script to create the table with 5 million rows. This may take a few minutes to run.</p>
<pre class="command-line language-terminal" data-output="2-100"data-prompt=">"><code class="language-terminal">sqlcmd -S localhost -U sa -P your_password -d SampleDB -t 60000 -i .\SqlServerColumnstoreSample\CreateSampleTable.sql</code></pre>
<p>Using your favorite text editor, create a new file called <b>columnstore.php</b> in the <i>SqlServerColumnstoreSample</i> folder. Paste the following code inside it. Don't forget to replace the username and password with your own. Save and close the file. </p>
<pre><code class="language-php">
&lt;?php
$time_start = microtime(true);

$serverName = "localhost";
$connectionOptions = array(
    "Database" => "SampleDB",
    "Uid" => "sa",
    "PWD" => "your_password"
);
//Establishes the connection
$conn = sqlsrv_connect($serverName, $connectionOptions);

//Read Query
$tsql= "SELECT SUM(Price) as sum FROM Table_with_5M_rows";
$getResults= sqlsrv_query($conn, $tsql);
echo ("Sum: ");
if ($getResults == FALSE)
    die(FormatErrors(sqlsrv_errors()));
while ($row = sqlsrv_fetch_array($getResults, SQLSRV_FETCH_ASSOC)) {
    echo ($row['sum'] . PHP_EOL);

}
sqlsrv_free_stmt($getResults);

function FormatErrors( $errors )  
{  
    /* Display errors. */  
    echo "Error information: <br/>";  
  
    foreach ( $errors as $error )  
    {  
        echo "SQLSTATE: ".$error['SQLSTATE']."<br/>";  
        echo "Code: ".$error['code']."<br/>";  
        echo "Message: ".$error['message']."<br/>";  
    }  
}
$time_end = microtime(true);
$execution_time = round((($time_end - $time_start)*1000),2);
echo 'QueryTime: '.$execution_time.' ms';

  
?&gt;

</code></pre>
<p>Run the PHP script from the terminal.</p>
<pre class="command-line language-terminal" data-prompt=">"><code class="language-terminal">php columnstore.php</code></pre>
<pre><code class="language-results">Sum: 5000000 
QueryTime: 363ms</code></pre>
<p>Now let's add a columnstore index your table. </p>
<pre class="command-line language-terminal" data-prompt=">"><code class="language-terminal">sqlcmd -S localhost -U sa -P your_password -d SampleDB -Q "CREATE CLUSTERED COLUMNSTORE INDEX Columnstoreindex ON Table_with_5M_rows;"</code></pre>
<p>Re-run the columnstore.php script and notice how long the query took to complete this time.</p>
<pre class="command-line language-terminal" data-prompt=">"><code class="language-terminal">php columnstore.php</code></pre>
<pre><code class="language-results">Sum: 5000000
QueryTime: 5ms</code></pre>

<p><img src="https://deve2e.azureedge.net/sqlchoice/static/images/completeStar.png" alt="goldstar" style="width:25px;height:25px;"> The performance of the query was greatly improved! 
                            <br>Now that you've built a few PHP apps with SQL Server, continue checking out other SQL Server features.</p>
{% endmacro %}


<!--Macro for a Larael app on Windows-->
{% macro phpLaravelWindows() %}
<h4>Configure a Laravel app that connects to SQL Server</a></h4>

<p>In this section we will cover how you can configure a Laravel application to use SQL Server. We will be using an existing todo application to demonstrate how you can use SQL Server with Laravel. </p>                         

<p>1. Download our sample Laravel application.</p>
<pre class="command-line language-terminal" data-prompt=">"><code class="language-terminal">wget "https://aka.ms/laravel.zip"</code></pre> 
<p>2. Unzip the contents of the file you downloaded. 
<p>3. Install <b>Composer</b>. Composer is a popular dependency management tool for PHP, used to facilitate installation and updates for project dependencies. Run the below in cmd as administrator.</p>
                            <pre class="command-line language-terminal" data-prompt=">"><code class="language-terminal">cd laravel
choco install -y composer</code></pre> 
<p>Change to the project directory and install all project dependencies.</p>
<pre class="command-line language-terminal" data-prompt=">"><code class="language-terminal">composer install
</code></pre> 
<p>Edit the <b>database.php</b> file in the <i>\larvel\config</i> folder using your favorite text editor with the settings below. Don't forget to update the username and password with your own. Save and close the file. </p>
<pre class="code-toolbar"><code class="language-php">
'sqlsrv' => [
        'driver'   => 'sqlsrv',
        'host'     => 'localhost',
        'database' => env('DB_DATABASE', 'SampleDB'),
        'username' => env('DB_USERNAME', 'sa'),
        'password' => env('DB_PASSWORD', 'your_password'),
        'prefix'   => '',
]
</code></pre>
<p>Run a migration. This will use the Laravel ORM (Eloquent) to create the required tables and schema for the app.</p> 
<pre class="command-line language-terminal" data-prompt=">"><code class="language-terminal">php artisan migrate</code></pre> 


<pre><code class="language-results">                             
**************************************
*     Application In Production!     *
**************************************

 Do you really wish to run this command? [y/N] (yes/no) [no]:
 > yes

Migration table created successfully.
Migrated: 2014_10_12_000000_create_users_table
Migrated: 2014_10_12_100000_create_password_resets_table
Migrated: 2015_05_31_072511_create_todos_table

</code></pre>

<pre class="command-line language-terminal" data-prompt=">"><code class="language-terminal">php artisan serve</code></pre> 


<pre><code class="language-results">           
Laravel development server started on http://localhost:8000/
</code></pre>

<p>You can create a new user and assign tasks yourself. Verify that the data is being stored on your SQL Server using sqlcmd.</p>


<pre class="command-line language-terminal" data-prompt=">"><code class="language-terminal">sqlcmd -S localhost -U sa -P your_password -d SampleDB -Q "SELECT * from dbo.todos"</code></pre>

<pre><code class="language-results">     
  
id      name            user_id    complete   created_at      updated_at
1	    Ship Helsinki	1	 0	   2016-11-09 22:01:11.000	 2016-11-09 22:01:11.000                                                                                                                                                                                                                                                          

(1 rows affected)</code></pre>

{% endmacro %}


<!--Macro for a Larael app on Ubuntu -->
{% macro phpLaravelUbuntu() %}

<h4>Configure a Laravel app that connects to SQL Server</a></h4>

<p>In this section we will cover how you can configure a Laravel application to use SQL Server. We will be using an exisiting todo application to demonstrate how you can use SQL Server with Laravel. </p>                         

<p>Download our sample Laravel application.</p>                            
 <pre class="command-line language-terminal" data-prompt="$"><code class="language-terminal">
wget "https://aka.ms/laravel.tar.gz"
tar -xzf laravel.tar.gz
cd laravel
</code></pre> 
<p>Install <b>Composer</b>. Composer is a popular dependency management tool for PHP, used to facilitate installation and updates for project dependencies.</p>
                            <pre class="command-line language-terminal" data-prompt="$"><code class="language-terminal">
curl -sS https://getcomposer.org/installer | sudo php -- --install-dir=/usr/local/bin --filename=composer
</code></pre> 

<p>Install all project dependencies. </p>
<pre class="command-line language-terminal" data-prompt="$"><code class="language-terminal">composer install
</code></pre> 
<p>Edit the <b>database.php</b> file in the <i>/larvel/config</i> folder using your favorite text editor with the settings below. Don't forget to update the username and password with your own. Save and close the file. </p>
<pre class="code-toolbar"><code class="language-php">
'sqlsrv' => [
        'driver'   => 'sqlsrv',
        'host'     => 'localhost',
        'database' => env('DB_DATABASE', 'SampleDB'),
        'username' => env('DB_USERNAME', 'sa'),
        'password' => env('DB_PASSWORD', 'your_password'),
        'prefix'   => '',
]
</code></pre>

<p>Run a migration. This will use the Laravel ORM (Eloquent) to create the required tables and schema for the app.</p> 
<pre class="command-line language-terminal" data-prompt="$"><code class="language-terminal">php artisan migrate</code></pre> 


<pre><code class="language-results">                             
**************************************
*     Application In Production!     *
**************************************

 Do you really wish to run this command? [y/N] (yes/no) [no]:
 > yes

Migration table created successfully.
Migrated: 2014_10_12_000000_create_users_table
Migrated: 2014_10_12_100000_create_password_resets_table
Migrated: 2015_05_31_072511_create_todos_table

</code></pre>

<pre class="command-line language-terminal" data-prompt="$"><code class="language-terminal">php artisan serve</code></pre> 


<pre><code class="language-results">           
Laravel development server started on http://localhost:8000/
</code></pre>

<p>You can create a new user and assign tasks yourself. Verify that the data is being stored on your SQL Server using sqlcmd.</p>


<pre class="command-line language-terminal" data-prompt="$"><code class="language-terminal">sqlcmd -S localhost -U sa -P your_password -d SampleDB -Q "SELECT * from dbo.todos"</code></pre>

<pre><code class="language-results">     
  
id      name            user_id    complete   created_at      updated_at
1	    Ship Helsinki	1	 0	   2016-11-09 22:01:11.000	  2016-11-09 22:01:11.000                                                                                                                                                                                                                                                          

(1 rows affected)</code></pre>

{% endmacro %}

<!--Macro for a PHP CRUD app on RHEL -->
{% macro phpRHELCRUD() %}
<h4>Create a PHP app that connects to SQL Server and executes queries</h4>
<p>Install the Microsoft PHP Driver for SQL Server and its prerequisites</p>
<pre class="command-line" data-prompt="$"><code class="language-terminal">
sudo su
curl https://packages.microsoft.com/config/rhel/7/prod.repo > /etc/yum.repos.d/mssql-release.repo
exit
sudo yum update
sudo yum remove unixODBC #to avoid conflicts
sudo ACCEPT_EULA=Y yum install msodbcsql 
sudo yum install unixODBC-utf16-devel 
yum groupinstall "Development Tools"
sudo pecl install sqlsrv pdo_sqlsrv
sudo echo "extension= pdo_sqlsrv.so" >> `php --ini | grep "Loaded Configuration" | sed -e "s|.*:\s*||"`
sudo echo "extension= sqlsrv.so" >> `php --ini | grep "Loaded Configuration" | sed -e "s|.*:\s*||"`
</code></pre>
<p>Create a database that will be used for the rest of this tutorial by connecting to SQL Server using sqlcmd and executing the following statement. Don't forget to update the username and password with your own.</p>
<pre class="command-line language-terminal" data-prompt="$"><code class="language-terminal">sqlcmd -S localhost -U sa -P your_password -Q "CREATE DATABASE SampleDB;"</code></pre>
<p>In your home directory, create a new folder called <i>SqlServerSample</i>.</p>
<pre class="command-line" data-prompt="$"><code class="language-terminal">
mkdir SqlServerSample
cd SqlServerSample
</code></pre>
<p> Using your favorite text editor, create a new file called <b>connect.php</b> in the <i>SqlServerSample</i> folder. Paste the code below inside into the new file. Don't forget to update the username and password with your own. Save and close the file. </p>
<pre><code class="language-php">
&lt;?php
$serverName = "localhost";
$connectionOptions = array(
    "Database" => "SampleDB",
    "Uid" => "sa",
    "PWD" => "your_password"
);
//Establishes the connection
$conn = sqlsrv_connect($serverName, $connectionOptions);
if($conn)
    echo "Connected!"
?&gt;
 </code></pre>
<p>Run your PHP script from the terminal.</p>
<pre class="command-line language-terminal" data-prompt="$"><code class="language-terminal">php connect.php</code></pre>
<pre><code class="language-results">Connected!
</code></pre>
<p>Execute the T-SQL script below in the terminal with sqlcmd to create a <a href="https://msdn.microsoft.com/en-us/library/aa578080.aspx">schema</a>, <a href="https://msdn.microsoft.com/en-us/library/ms189084.aspx">table</a>, and <a href="https://msdn.microsoft.com/en-us/library/ms174335.aspx">insert</a> a few rows.</p>{{macros.sqlcmdLinux()}}
<p>Using your favorite text editor, create a new file called <b>crud.php</b> in the <i>SqlServerSample</i> folder. Paste the code below inside into the new file. This will <a href="https://msdn.microsoft.com/en-us/library/ms174335.aspx">insert</a>, <a href="https://msdn.microsoft.com/en-us/library/ms177523.aspx">update</a>, <a href="https://msdn.microsoft.com/en-us/library/ms189835.aspx">delete</a>, and <a href="https://msdn.microsoft.com/en-us/library/ms189499.aspx">read</a> a few rows. Don't forget to update the username and password with your own. Save and close the file. </p>
<pre><code class="language-php">
&lt;?php
$serverName = "localhost";
$connectionOptions = array(
    "Database" => "SampleDB",
    "Uid" => "sa",
    "PWD" => "your_password"
);
//Establishes the connection
$conn = sqlsrv_connect($serverName, $connectionOptions);

//Insert Query
echo ("Inserting a new row into table" . PHP_EOL);
$tsql= "INSERT INTO TestSchema.Employees (Name, Location) VALUES (?,?);";
$params = array('Jake','United States');  
$getResults= sqlsrv_query($conn, $tsql, $params);
$rowsAffected = sqlsrv_rows_affected($getResults);  
if ($getResults == FALSE or $rowsAffected == FALSE)
    die(FormatErrors(sqlsrv_errors()));
echo ($rowsAffected. " row(s) inserted: " . PHP_EOL);

sqlsrv_free_stmt($getResults);

//Update Query

$userToUpdate = 'Nikita';
$tsql= "UPDATE TestSchema.Employees SET Location = ? WHERE Name = ?";
$params = array('Sweden', $userToUpdate); 
echo("Updating Location for user " . $userToUpdate . PHP_EOL);

$getResults= sqlsrv_query($conn, $tsql, $params);
$rowsAffected = sqlsrv_rows_affected($getResults);  
if ($getResults == FALSE or $rowsAffected == FALSE)
    die(FormatErrors(sqlsrv_errors()));
echo ($rowsAffected. " row(s) updated: " . PHP_EOL);
sqlsrv_free_stmt($getResults);

//Delete Query
$userToDelete = 'Jared';
$tsql= "DELETE FROM TestSchema.Employees WHERE Name = ?";
$params = array($userToDelete); 
$getResults= sqlsrv_query($conn, $tsql, $params);
echo("Deleting user " . $userToDelete . PHP_EOL);
$rowsAffected = sqlsrv_rows_affected($getResults);  
if ($getResults == FALSE or $rowsAffected == FALSE)
    die(FormatErrors(sqlsrv_errors()));
echo ($rowsAffected. " row(s) deleted: " . PHP_EOL);
sqlsrv_free_stmt($getResults);


//Read Query
$tsql= "SELECT Id, Name, Location FROM TestSchema.Employees;";
$getResults= sqlsrv_query($conn, $tsql);
echo ("Reading data from table" . PHP_EOL);
if ($getResults == FALSE)
    die(FormatErrors(sqlsrv_errors()));
while ($row = sqlsrv_fetch_array($getResults, SQLSRV_FETCH_ASSOC)) {
    echo ($row['Id'] . " " . $row['Name'] . " " . $row['Location'] . PHP_EOL);

}
sqlsrv_free_stmt($getResults);

function FormatErrors( $errors )  
{  
    /* Display errors. */  
    echo "Error information: <br/>";  
  
    foreach ( $errors as $error )  
    {  
        echo "SQLSTATE: ".$error['SQLSTATE']."<br/>";  
        echo "Code: ".$error['code']."<br/>";  
        echo "Message: ".$error['message']."<br/>";  
    }  
}  
?&gt;
</code></pre>
<p>Run your PHP script from the terminal.</p>
<pre class="command-line language-terminal" data-prompt="$"><code class="language-terminal">php crud.php</code></pre>
<pre><code class="language-results">
Inserting a new row into table
1 row(s) inserted: 
Updating Location for user Nikita
1 row(s) updated: 
Deleting user Jared
1 row(s) deleted: 
Reading data from table
2 Nikita Sweden
3 Tom Germany
4 Jake United States
</code></pre>
{% endmacro %}


<!--Macro for a PHP CRUD app on SLES -->
{% macro phpSLESCRUD() %}
<h4>Create a PHP app that connects to SQL Server and executes queries</h4>
<p>Install the Microsoft PHP Driver for SQL Server and its prerequisites</p>
<pre class="command-line" data-prompt="$"><code class="language-terminal">
sudo su
zypper ar https://packages.microsoft.com/config/sles/12/prod.repo 
zypper update
ACCEPT_EULA=Y zypper install msodbcsql
zypper install unixODBC-devel php7 php7-devel php7-openssl php7-phar php7-mcrypt php7-mbstring php7-pear gcc gcc-c++ make
pecl install sqlsrv pdo_sqlsrv
sudo echo "extension= pdo_sqlsrv.so" >> `php --ini | grep "Loaded Configuration" | sed -e "s|.*:\s*||"`
sudo echo "extension= sqlsrv.so" >> `php --ini | grep "Loaded Configuration" | sed -e "s|.*:\s*||"`
exit
</code></pre>
<p>Create a database that will be used for the rest of this tutorial by connecting to SQL Server using sqlcmd and executing the following statement. Don't forget to update the username and password with your own.</p>
<pre class="command-line language-terminal" data-prompt="$"><code class="language-terminal">sqlcmd -S localhost -U sa -P your_password -Q "CREATE DATABASE SampleDB;"</code></pre>
<p>In your home directory, create a new folder called <i>SqlServerSample</i>.</p>
<pre class="command-line" data-prompt="$"><code class="language-terminal">
mkdir SqlServerSample
cd SqlServerSample
</code></pre>
<p> Using your favorite text editor, create a new file called <b>connect.php</b> in the <i>SqlServerSample</i> folder. Paste the code below inside into the new file. Don't forget to update the username and password with your own. Save and close the file. </p>
<pre><code class="language-php">
&lt;?php
$serverName = "localhost";
$connectionOptions = array(
    "Database" => "SampleDB",
    "Uid" => "sa",
    "PWD" => "your_password"
);
//Establishes the connection
$conn = sqlsrv_connect($serverName, $connectionOptions);
if($conn)
    echo "Connected!"
?&gt;
 </code></pre>
<p>Run your PHP script from the terminal.</p>
<pre class="command-line language-terminal" data-prompt="$"><code class="language-terminal">php connect.php</code></pre>
<pre><code class="language-results">Connected!
</code></pre>
<p>Execute the T-SQL script below in the terminal with sqlcmd to create a <a href="https://msdn.microsoft.com/en-us/library/aa578080.aspx">schema</a>, <a href="https://msdn.microsoft.com/en-us/library/ms189084.aspx">table</a>, and <a href="https://msdn.microsoft.com/en-us/library/ms174335.aspx">insert</a> a few rows.</p>{{macros.sqlcmdLinux()}}
<p>Using your favorite text editor, create a new file called <b>crud.php</b> in the <i>SqlServerSample</i> folder. Paste the code below inside into the new file. This will <a href="https://msdn.microsoft.com/en-us/library/ms174335.aspx">insert</a>, <a href="https://msdn.microsoft.com/en-us/library/ms177523.aspx">update</a>, <a href="https://msdn.microsoft.com/en-us/library/ms189835.aspx">delete</a>, and <a href="https://msdn.microsoft.com/en-us/library/ms189499.aspx">read</a> a few rows. Don't forget to update the username and password with your own. Save and close the file. </p>
<pre><code class="language-php">
&lt;?php
$serverName = "localhost";
$connectionOptions = array(
    "Database" => "SampleDB",
    "Uid" => "sa",
    "PWD" => "your_password"
);
//Establishes the connection
$conn = sqlsrv_connect($serverName, $connectionOptions);

//Insert Query
echo ("Inserting a new row into table" . PHP_EOL);
$tsql= "INSERT INTO TestSchema.Employees (Name, Location) VALUES (?,?);";
$params = array('Jake','United States');  
$getResults= sqlsrv_query($conn, $tsql, $params);
$rowsAffected = sqlsrv_rows_affected($getResults);  
if ($getResults == FALSE or $rowsAffected == FALSE)
    die(FormatErrors(sqlsrv_errors()));
echo ($rowsAffected. " row(s) inserted: " . PHP_EOL);

sqlsrv_free_stmt($getResults);

//Update Query

$userToUpdate = 'Nikita';
$tsql= "UPDATE TestSchema.Employees SET Location = ? WHERE Name = ?";
$params = array('Sweden', $userToUpdate); 
echo("Updating Location for user " . $userToUpdate . PHP_EOL);

$getResults= sqlsrv_query($conn, $tsql, $params);
$rowsAffected = sqlsrv_rows_affected($getResults);  
if ($getResults == FALSE or $rowsAffected == FALSE)
    die(FormatErrors(sqlsrv_errors()));
echo ($rowsAffected. " row(s) updated: " . PHP_EOL);
sqlsrv_free_stmt($getResults);

//Delete Query
$userToDelete = 'Jared';
$tsql= "DELETE FROM TestSchema.Employees WHERE Name = ?";
$params = array($userToDelete); 
$getResults= sqlsrv_query($conn, $tsql, $params);
echo("Deleting user " . $userToDelete . PHP_EOL);
$rowsAffected = sqlsrv_rows_affected($getResults);  
if ($getResults == FALSE or $rowsAffected == FALSE)
    die(FormatErrors(sqlsrv_errors()));
echo ($rowsAffected. " row(s) deleted: " . PHP_EOL);
sqlsrv_free_stmt($getResults);


//Read Query
$tsql= "SELECT Id, Name, Location FROM TestSchema.Employees;";
$getResults= sqlsrv_query($conn, $tsql);
echo ("Reading data from table" . PHP_EOL);
if ($getResults == FALSE)
    die(FormatErrors(sqlsrv_errors()));
while ($row = sqlsrv_fetch_array($getResults, SQLSRV_FETCH_ASSOC)) {
    echo ($row['Id'] . " " . $row['Name'] . " " . $row['Location'] . PHP_EOL);

}
sqlsrv_free_stmt($getResults);

function FormatErrors( $errors )  
{  
    /* Display errors. */  
    echo "Error information: <br/>";  
  
    foreach ( $errors as $error )  
    {  
        echo "SQLSTATE: ".$error['SQLSTATE']."<br/>";  
        echo "Code: ".$error['code']."<br/>";  
        echo "Message: ".$error['message']."<br/>";  
    }  
}  
?&gt;
</code></pre>
<p>Run your PHP script from the terminal.</p>
<pre class="command-line language-terminal" data-prompt="$"><code class="language-terminal">php crud.php</code></pre>
<pre><code class="language-results">
Inserting a new row into table
1 row(s) inserted: 
Updating Location for user Nikita
1 row(s) updated: 
Deleting user Jared
1 row(s) deleted: 
Reading data from table
2 Nikita Sweden
3 Tom Germany
4 Jake United States
</code></pre>
{% endmacro %}

{% macro discus() %}
<br></br>
<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//sqlchoice.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
               
{% endmacro %}